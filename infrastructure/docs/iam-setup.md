# IAM setup

## Policies

Generate IAM policies with

```sh
npm run generate_iam_policies
```

Go to AWS console in _IAM > Policies_ and click _Create policy_ and add the corresponding JSON you find in the [infrastructure/iam folder](../iam/).
Once all policies are created continue with [IAM roles](#roles).

### Elastic IPs

Used by _binance-proxy_ service to get a static IP and attach it to its EC2 instance.
JSON file generated by [ElasticIpsPolicy](../src/aws/ElasticIpsPolicy.ts).

### Lambdas

Used by API lambdas. Files generated by:

- [LogsPolicy](../src/aws/LogsPolicy.ts).
- [LambdaInvokePolicy](../src/aws/LambdaInvokePolicy.ts).

### S3 data

Used by any service that needs to read or write to S3 data bucket.
JSON file generated by [S3ReadWriteDataPolicy](../src/aws/S3ReadWriteDataPolicy.ts).

### SES noreply

Used by services that need to send emails via [email-messages](../../email-messages) workspace.
JSON file generated by [SesNopeplyPolicy](../src/aws/SesNopeplyPolicy.ts).

## Roles

### API lambda role

Create a IAM role for _API Gateway_ lambdas with name `${PROJECT_SHORT_NAME}-api-role`.

Add policies:

- [Lambdas policies](#lambdas)
- [S3 data policy](#s3-data)
- [SES noreply policy](#ses-noreply)

### EC2 Roles

When creating a IAM role for an EC2 service, select:

- Trusted entity type: _AWS service_
- Use case: _EC2_.

#### binance-proxy

Create a IAM role for _binance-proxy_ service with name `${PROJECT_SHORT_NAME}-binance-proxy-role`.

Add policies:

- [Elastic IPs policy](#elastic-ips)
- [S3 data policy](#s3-data)

#### executor

Create a IAM role for _executor_ service with name `${PROJECT_SHORT_NAME}-executor-role`.

Add policies:

- [S3 data policies](#s3-data)
- [SES noreply policy](#ses-noreply)
